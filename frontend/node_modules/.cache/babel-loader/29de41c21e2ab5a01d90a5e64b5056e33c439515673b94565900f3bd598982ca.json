{"ast":null,"code":"import React,{useEffect,useRef}from\"react\";import{io}from\"socket.io-client\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const socket=io(\"http://localhost:3000\");export default function VideoChat(){const localVideo=useRef(null);const remoteVideo=useRef(null);const peer=useRef(null);const localStream=useRef(null);useEffect(()=>{async function init(){// 1. Get camera + microphone\nlocalStream.current=await navigator.mediaDevices.getUserMedia({video:true,audio:true});localVideo.current.srcObject=localStream.current;// 2. Create peer connection\npeer.current=new RTCPeerConnection({iceServers:[{urls:\"stun:stun.l.google.com:19302\"}]});// 3. Add local tracks\nlocalStream.current.getTracks().forEach(track=>{peer.current.addTrack(track,localStream.current);});// 4. When remote video arrives\npeer.current.ontrack=event=>{remoteVideo.current.srcObject=event.streams[0];};// 5. Send ICE candidates\npeer.current.onicecandidate=event=>{if(event.candidate){socket.emit(\"ice-candidate\",event.candidate);}};// If this user gets paired → create offer\nsocket.on(\"paired\",async()=>{const offer=await peer.current.createOffer();await peer.current.setLocalDescription(offer);socket.emit(\"offer\",offer);});// Receive offer\nsocket.on(\"offer\",async offer=>{await peer.current.setRemoteDescription(offer);const answer=await peer.current.createAnswer();await peer.current.setLocalDescription(answer);socket.emit(\"answer\",answer);});// Receive answer\nsocket.on(\"answer\",async answer=>{await peer.current.setRemoteDescription(answer);});// Receive ICE candidate\nsocket.on(\"ice-candidate\",async candidate=>{try{await peer.current.addIceCandidate(candidate);}catch(err){console.error(\"ICE Error\",err);}});}init();},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"video-container\",children:[/*#__PURE__*/_jsx(\"video\",{ref:localVideo,autoPlay:true,muted:true,className:\"video\"}),/*#__PURE__*/_jsx(\"video\",{ref:remoteVideo,autoPlay:true,className:\"video\"})]});}","map":{"version":3,"names":["React","useEffect","useRef","io","jsx","_jsx","jsxs","_jsxs","socket","VideoChat","localVideo","remoteVideo","peer","localStream","init","current","navigator","mediaDevices","getUserMedia","video","audio","srcObject","RTCPeerConnection","iceServers","urls","getTracks","forEach","track","addTrack","ontrack","event","streams","onicecandidate","candidate","emit","on","offer","createOffer","setLocalDescription","setRemoteDescription","answer","createAnswer","addIceCandidate","err","console","error","className","children","ref","autoPlay","muted"],"sources":["C:/Users/vishn/OneDrive/Desktop/live chat/frontend/frontend/src/components/VideoChat.js"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\r\nimport { io } from \"socket.io-client\";\r\n\r\nconst socket = io(\"http://localhost:3000\");\r\n\r\nexport default function VideoChat() {\r\n  const localVideo = useRef(null);\r\n  const remoteVideo = useRef(null);\r\n\r\n  const peer = useRef(null);\r\n  const localStream = useRef(null);\r\n\r\n  useEffect(() => {\r\n    async function init() {\r\n      // 1. Get camera + microphone\r\n      localStream.current = await navigator.mediaDevices.getUserMedia({\r\n        video: true,\r\n        audio: true\r\n      });\r\n\r\n      localVideo.current.srcObject = localStream.current;\r\n\r\n      // 2. Create peer connection\r\n      peer.current = new RTCPeerConnection({\r\n        iceServers: [\r\n          { urls: \"stun:stun.l.google.com:19302\" }\r\n        ]\r\n      });\r\n\r\n      // 3. Add local tracks\r\n      localStream.current.getTracks().forEach(track => {\r\n        peer.current.addTrack(track, localStream.current);\r\n      });\r\n\r\n      // 4. When remote video arrives\r\n      peer.current.ontrack = (event) => {\r\n        remoteVideo.current.srcObject = event.streams[0];\r\n      };\r\n\r\n      // 5. Send ICE candidates\r\n      peer.current.onicecandidate = (event) => {\r\n        if (event.candidate) {\r\n          socket.emit(\"ice-candidate\", event.candidate);\r\n        }\r\n      };\r\n\r\n      // If this user gets paired → create offer\r\n      socket.on(\"paired\", async () => {\r\n        const offer = await peer.current.createOffer();\r\n        await peer.current.setLocalDescription(offer);\r\n        socket.emit(\"offer\", offer);\r\n      });\r\n\r\n      // Receive offer\r\n      socket.on(\"offer\", async (offer) => {\r\n        await peer.current.setRemoteDescription(offer);\r\n\r\n        const answer = await peer.current.createAnswer();\r\n        await peer.current.setLocalDescription(answer);\r\n\r\n        socket.emit(\"answer\", answer);\r\n      });\r\n\r\n      // Receive answer\r\n      socket.on(\"answer\", async (answer) => {\r\n        await peer.current.setRemoteDescription(answer);\r\n      });\r\n\r\n      // Receive ICE candidate\r\n      socket.on(\"ice-candidate\", async (candidate) => {\r\n        try {\r\n          await peer.current.addIceCandidate(candidate);\r\n        } catch (err) {\r\n          console.error(\"ICE Error\", err);\r\n        }\r\n      });\r\n    }\r\n\r\n    init();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"video-container\">\r\n      <video ref={localVideo} autoPlay muted className=\"video\"></video>\r\n      <video ref={remoteVideo} autoPlay className=\"video\"></video>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}